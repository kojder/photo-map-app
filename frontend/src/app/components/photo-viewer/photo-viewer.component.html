@if (viewerState?.isOpen) {
  <div class="photo-viewer-overlay" (click)="close()">
    <div 
      class="photo-viewer-content" 
      (click)="$event.stopPropagation()"
      (touchstart)="onTouchStart($event)"
      (touchmove)="onTouchMove($event)"
      (touchend)="onTouchEnd($event)"
    >
      <!-- Photo image -->
      <div class="photo-container">
        <!-- Loading spinner (only after delay) -->
        @if (showSpinner) {
          <div class="loading-spinner" data-testid="viewer-spinner">
            <div class="spinner"></div>
          </div>
        }
        
        <!-- Photo image -->
        <img 
          [src]="imageUrl" 
          [alt]="currentPhoto?.originalFilename || 'Photo'"
          class="photo-viewer-image"
          (load)="onImageLoad()"
          (error)="onImageError()"
          data-testid="viewer-image"
        />
      </div>

      <!-- Navigation buttons -->
      <div class="photo-viewer-controls">
        <button 
          *ngIf="!isFirstPhoto()"
          (click)="previous(); $event.stopPropagation()" 
          class="nav-button nav-button-left"
          aria-label="Previous photo"
          data-testid="viewer-prev-button"
        >
          ‹
        </button>

        <button 
          *ngIf="!isLastPhoto()"
          (click)="next(); $event.stopPropagation()" 
          class="nav-button nav-button-right"
          aria-label="Next photo"
          data-testid="viewer-next-button"
        >
          ›
        </button>
      </div>

      <!-- Footer with counter and fullscreen toggle -->
      <div class="photo-viewer-footer">
        <span class="photo-counter" data-testid="viewer-counter">
          {{ photoCounter }}
        </span>
        
        <button 
          (click)="toggleFullscreen(); $event.stopPropagation()" 
          class="fullscreen-button"
          [attr.aria-label]="isFullscreen ? 'Exit fullscreen' : 'Enter fullscreen'"
          data-testid="viewer-fullscreen-button"
          title="{{ isFullscreen ? 'Exit fullscreen' : 'Enter fullscreen' }}"
        >
          @if (isFullscreen) {
            <span>⛶</span>
          } @else {
            <span>⛶</span>
          }
        </button>
      </div>

      <!-- Close button -->
      <button 
        (click)="close(); $event.stopPropagation()" 
        class="close-button"
        aria-label="Close viewer"
        data-testid="viewer-close-button"
      >
        ✕
      </button>
    </div>
  </div>
}
