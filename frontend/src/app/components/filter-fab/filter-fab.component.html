<!-- FAB Button (always visible) -->
<button
  (click)="toggleFilters()"
  class="fixed bottom-6 right-6 z-40 bg-blue-600 text-white p-4 rounded-full shadow-lg hover:bg-blue-700 hover:scale-110 transition-all"
  data-testid="filter-fab-button"
>
  <!-- Funnel Icon (solid) -->
  <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
    <path
      fill-rule="evenodd"
      d="M3.792 2.938A49.069 49.069 0 0112 2.25c2.797 0 5.54.236 8.209.688a1.857 1.857 0 011.541 1.836v1.044a3 3 0 01-.879 2.121l-6.182 6.182a1.5 1.5 0 00-.439 1.061v2.927a3 3 0 01-1.658 2.684l-1.757.878A.75.75 0 019.75 21v-5.818a1.5 1.5 0 00-.44-1.06L3.13 7.938a3 3 0 01-.879-2.121V4.774c0-.897.64-1.683 1.542-1.836z"
      clip-rule="evenodd"
    />
  </svg>

  <!-- Badge (licznik aktywnych filtrów) -->
  @if (hasActiveFilters()) {
    <span
      class="absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-xs rounded-full flex items-center justify-center font-semibold"
      data-testid="filter-fab-badge"
    >
      {{ activeFilterCount() }}
    </span>
  }
</button>

<!-- Backdrop (overlay) -->
@if (filtersOpen()) {
  <div
    (click)="closeFilters()"
    class="fixed inset-0 bg-black bg-opacity-30 z-40 transition-opacity"
    data-testid="filter-backdrop"
  ></div>
}

<!-- Desktop Filter Panel (side slide-in, ≥ 768px) -->
<div
  class="hidden md:block fixed top-0 right-0 h-full w-80 bg-white shadow-2xl z-50 transform transition-transform duration-300"
  [class.translate-x-0]="filtersOpen()"
  [class.translate-x-full]="!filtersOpen()"
  data-testid="filter-panel-desktop"
>
  <!-- Panel Header -->
  <div class="flex justify-between items-center p-4 border-b border-gray-200">
    <h3 class="text-lg font-semibold text-gray-900">Filters</h3>
    <button
      (click)="closeFilters()"
      class="p-2 hover:bg-gray-100 rounded-lg"
      data-testid="filter-close-button"
    >
      <!-- Close Icon (x-mark) -->
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>
  </div>

  <!-- Panel Content (scrollable) -->
  <div class="p-4 space-y-4 overflow-y-auto h-[calc(100vh-140px)]">
    <!-- Date From -->
    <div>
      <label for="filter-date-from" class="block text-sm font-medium text-gray-700 mb-1">Date From</label>
      <app-date-picker
        [(ngModel)]="dateFrom"
        [testId]="'filter-date-from'"
        [placeholder]="'dd.mm.yyyy'"
        (dateChange)="onFilterChange()"
      ></app-date-picker>
    </div>

    <!-- Date To -->
    <div>
      <label for="filter-date-to" class="block text-sm font-medium text-gray-700 mb-1">Date To</label>
      <app-date-picker
        [(ngModel)]="dateTo"
        [testId]="'filter-date-to'"
        [placeholder]="'dd.mm.yyyy'"
        (dateChange)="onFilterChange()"
      ></app-date-picker>
    </div>

    <!-- Min Rating -->
    <div>
      <label for="filter-rating" class="block text-sm font-medium text-gray-700 mb-1">Min Rating</label>
      <select
        id="filter-rating"
        [(ngModel)]="minRating"
        (change)="onFilterChange()"
        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
        data-testid="filter-rating"
      >
        <option [ngValue]="null">All</option>
        <option [ngValue]="1">1+</option>
        <option [ngValue]="2">2+</option>
        <option [ngValue]="3">3+</option>
        <option [ngValue]="4">4+</option>
        <option [ngValue]="5">5</option>
      </select>
    </div>
  </div>

  <!-- Panel Footer -->
  <div class="absolute bottom-0 left-0 right-0 p-4 border-t border-gray-200 bg-white">
    <div class="flex space-x-2">
      <button
        (click)="onClearFilters()"
        class="flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors"
        data-testid="filter-clear-button"
      >
        Clear
      </button>
      <button
        (click)="onApplyFilters()"
        class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
        data-testid="filter-apply-button"
      >
        Apply
      </button>
    </div>
  </div>
</div>

<!-- Mobile Filter Panel (bottom sheet, < 768px) -->
<div
  class="md:hidden fixed bottom-0 left-0 right-0 bg-white shadow-2xl z-50 rounded-t-2xl transform transition-transform duration-300 max-h-[80vh] flex flex-col"
  [class.translate-y-0]="filtersOpen()"
  [class.translate-y-full]="!filtersOpen()"
  data-testid="filter-panel-mobile"
>
  <!-- Panel Header -->
  <div class="flex justify-between items-center p-4 border-b border-gray-200 flex-shrink-0">
    <h3 class="text-lg font-semibold text-gray-900">Filters</h3>
    <button
      (click)="closeFilters()"
      class="p-2 hover:bg-gray-100 rounded-lg"
      data-testid="filter-close-button-mobile"
    >
      <!-- Close Icon (x-mark) -->
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>
  </div>

  <!-- Panel Content (scrollable) -->
  <div class="p-4 space-y-4 overflow-y-auto flex-1">
    <!-- Date From -->
    <div>
      <label for="filter-date-from-mobile" class="block text-sm font-medium text-gray-700 mb-1">Date From</label>
      <app-date-picker
        [(ngModel)]="dateFrom"
        [testId]="'filter-date-from-mobile'"
        [placeholder]="'dd.mm.yyyy'"
        (dateChange)="onFilterChange()"
      ></app-date-picker>
    </div>

    <!-- Date To -->
    <div>
      <label for="filter-date-to-mobile" class="block text-sm font-medium text-gray-700 mb-1">Date To</label>
      <app-date-picker
        [(ngModel)]="dateTo"
        [testId]="'filter-date-to-mobile'"
        [placeholder]="'dd.mm.yyyy'"
        (dateChange)="onFilterChange()"
      ></app-date-picker>
    </div>

    <!-- Min Rating -->
    <div>
      <label for="filter-rating-mobile" class="block text-sm font-medium text-gray-700 mb-1">Min Rating</label>
      <select
        id="filter-rating-mobile"
        [(ngModel)]="minRating"
        (change)="onFilterChange()"
        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
        data-testid="filter-rating-mobile"
      >
        <option [ngValue]="null">All</option>
        <option [ngValue]="1">1+</option>
        <option [ngValue]="2">2+</option>
        <option [ngValue]="3">3+</option>
        <option [ngValue]="4">4+</option>
        <option [ngValue]="5">5</option>
      </select>
    </div>
  </div>

  <!-- Panel Footer -->
  <div class="p-4 border-t border-gray-200 bg-white flex-shrink-0">
    <div class="flex space-x-2">
      <button
        (click)="onClearFilters()"
        class="flex-1 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors"
        data-testid="filter-clear-button-mobile"
      >
        Clear
      </button>
      <button
        (click)="onApplyFilters()"
        class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
        data-testid="filter-apply-button-mobile"
      >
        Apply
      </button>
    </div>
  </div>
</div>
